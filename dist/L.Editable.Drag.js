"use strict";if(L.Browser.svg){L.Path.include({_resetTransform:function(){this._container.setAttributeNS(null,"transform","")},_applyTransform:function(t){this._container.setAttributeNS(null,"transform","matrix("+t.join(" ")+")")}})}else{L.Path.include({_resetTransform:function(){if(this._skew){this._skew.on=false;this._container.removeChild(this._skew);this._skew=null}},_applyTransform:function(t){var i=this._skew;if(!i){i=this._createElement("skew");this._container.appendChild(i);i.style.behavior="url(#default#VML)";this._skew=i}var a=t[0].toFixed(8)+" "+t[1].toFixed(8)+" "+t[2].toFixed(8)+" "+t[3].toFixed(8)+" 0 0";var r=Math.floor(t[4]).toFixed()+", "+Math.floor(t[5]).toFixed()+"";var n=this._container.style;var e=parseFloat(n.left);var o=parseFloat(n.top);var s=parseFloat(n.width);var h=parseFloat(n.height);if(isNaN(e))e=0;if(isNaN(o))o=0;if(isNaN(s)||!s)s=1;if(isNaN(h)||!h)h=1;var g=(-e/s-.5).toFixed(8)+" "+(-o/h-.5).toFixed(8);i.on="f";i.matrix=a;i.origin=g;i.offset=r;i.on=true}})}L.Path.include({_onMouseClick:function(t){if(this.dragging&&this.dragging.moved()||this._map.dragging&&this._map.dragging.moved()){return}this._fireMouseEvent(t)}});/**
 * Leaflet vector features drag functionality
 * @preserve
 */
"use strict";L.Handler.PathDrag=L.Handler.extend({statics:{DRAGGABLE_CLS:"leaflet-path-draggable"},initialize:function(t){this._path=t;this._matrix=null;this._startPoint=null;this._dragStartPoint=null;this._dragInProgress=false;this._dragMoved=false},addHooks:function(){var t=L.Handler.PathDrag.DRAGGABLE_CLS;var i=this._path._path;this._path.on("mousedown",this._onDragStart,this);this._path.options.className=(this._path.options.className||"")+" "+t;if(!L.Path.CANVAS&&i){L.DomUtil.addClass(i,t)}},removeHooks:function(){var t=L.Handler.PathDrag.DRAGGABLE_CLS;var i=this._path._path;this._path.off("mousedown",this._onDragStart,this);this._path.options.className=(this._path.options.className||"").replace(t,"");if(!L.Path.CANVAS&&i){L.DomUtil.removeClass(i,t)}this._dragMoved=false},moved:function(){return this._dragMoved},inProgress:function(){return this._dragInProgress},_onDragStart:function(t){this._dragInProgress=true;this._startPoint=t.containerPoint.clone();this._dragStartPoint=t.containerPoint.clone();this._matrix=[1,0,0,1,0,0];if(this._path._point){this._point=this._path._point.clone()}this._path._map.on("mousemove",this._onDrag,this).on("mouseup",this._onDragEnd,this);this._dragMoved=false},_onDrag:function(t){var i=t.containerPoint.x;var a=t.containerPoint.y;var r=this._matrix;var n=this._path;var e=this._startPoint;var o=i-e.x;var s=a-e.y;if(!this._dragMoved&&(o||s)){this._dragMoved=true;n.fire("dragstart");if(n._popup){n._popup._close();n.off("click",n._openPopup,n)}}r[4]+=o;r[5]+=s;e.x=i;e.y=a;n._applyTransform(r);if(n._point){n._point.x=this._point.x+r[4];n._point.y=this._point.y+r[5]}n.fire("drag");L.DomEvent.stop(t.originalEvent)},_onDragEnd:function(t){L.DomEvent.stop(t);L.DomEvent._fakeStop({type:"click"});this._dragInProgress=false;this._path._resetTransform();this._transformPoints(this._matrix);this._path._map.off("mousemove",this._onDrag,this).off("mouseup",this._onDragEnd,this);this._path.fire("dragend",{distance:Math.sqrt(L.LineUtil._sqDist(this._dragStartPoint,t.containerPoint))});if(this._path._popup){L.Util.requestAnimFrame(function(){this._path.on("click",this._path._openPopup,this._path)},this)}this._matrix=null;this._startPoint=null;this._point=null;this._dragStartPoint=null},_transformPoint:function(t,i){var a=this._path;var r=L.point(i[4],i[5]);var n=a._map.options.crs;var e=n.transformation;var o=n.scale(a._map.getZoom());var s=n.projection;var h=e.untransform(r,o).subtract(e.untransform(L.point(0,0),o));return s.unproject(s.project(t)._add(h))},_transformPoints:function(t){var i=this._path;var a,r,n;var e=L.point(t[4],t[5]);var o=i._map.options.crs;var s=o.transformation;var h=o.scale(i._map.getZoom());var g=o.projection;var l=s.untransform(e,h).subtract(s.untransform(L.point(0,0),h));if(i._point){i._latlng=g.unproject(g.project(i._latlng)._add(l));i._point=this._point._add(e)}else if(i._originalPoints){for(a=0,r=i._originalPoints.length;a<r;a++){n=i._latlngs[a];i._latlngs[a]=g.unproject(g.project(n)._add(l));i._originalPoints[a]._add(e)}}if(i._holes){for(a=0,r=i._holes.length;a<r;a++){for(var d=0,_=i._holes[a].length;d<_;d++){n=i._holes[a][d];i._holes[a][d]=g.unproject(g.project(n)._add(l));i._holePoints[a][d]._add(e)}}}i._updatePath()}});L.Path.addInitHook(function(){if(this.options.draggable){if(this.dragging){this.dragging.enable()}else{this.dragging=new L.Handler.PathDrag(this);this.dragging.enable()}}else if(this.dragging){this.dragging.disable()}});L.Circle.prototype._getLatLng=L.Circle.prototype.getLatLng;L.Circle.prototype.getLatLng=function(){if(this.dragging&&this.dragging.inProgress()){return this.dragging._transformPoint(this._latlng,this.dragging._matrix)}else{return this._getLatLng()}};L.Polyline.prototype._getLatLngs=L.Polyline.prototype.getLatLngs;L.Polyline.prototype.getLatLngs=function(){if(this.dragging&&this.dragging.inProgress()){var t=this.dragging._matrix;var i=this._getLatLngs();for(var a=0,r=i.length;a<r;a++){i[a]=this.dragging._transformPoint(i[a],t)}return i}else{return this._getLatLngs()}};(function(){L.FeatureGroup.EVENTS+=" dragstart";function t(t,i,a){for(var r=0,n=t.length;r<n;r++){var e=t[r];e.prototype["_"+i]=e.prototype[i];e.prototype[i]=a}}function i(t){if(this.hasLayer(t)){return this}t.on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this);return this._addLayer.call(this,t)}function a(t){if(!this.hasLayer(t)){return this}t.off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this);return this._removeLayer.call(this,t)}t([L.MultiPolygon,L.MultiPolyline],"addLayer",i);t([L.MultiPolygon,L.MultiPolyline],"removeLayer",a);var r={_onDrag:function(t){var i=t.target;this.eachLayer(function(t){if(t!==i){t._applyTransform(i.dragging._matrix)}});this._propagateEvent(t)},_onDragEnd:function(t){var i=t.target;this.eachLayer(function(t){if(t!==i){t._resetTransform();t.dragging._transformPoints(i.dragging._matrix)}});this._propagateEvent(t)}};L.MultiPolygon.include(r);L.MultiPolyline.include(r)})();/**
 * Leaflet.Editable extension for dragging
 * @author Alexander Milevski <info@w8r.name>
 * @preserve
 */
L.Editable.include({options:L.Util.extend(L.Editable.prototype.options,{dragging:true}),createPolyline:function(t){var i=new this.options.polylineClass(t,{draggable:this.options.dragging,editOptions:{editTools:this}});this.fireAndForward("editable:created",{layer:i});return i},createPolygon:function(t){var i=new this.options.polygonClass(t,{draggable:this.options.dragging,editOptions:{editTools:this}});this.fireAndForward("editable:created",{layer:i});return i}});L.Editable.PathEditor.include({options:{dragging:true},enable:function(){this._enable();this.feature.on("dragstart",this._onFeatureDragStart,this).on("drag",this._onFeatureDrag,this).on("dragend",this._onFeatureDragEnd,this);return this},_enable:L.Editable.PathEditor.prototype.enable,disable:function(){this._disable();this.feature.off("dragstart",this._onFeatureDragStart,this).off("drag",this._onFeatureDrag,this).off("dragend",this._onFeatureDragEnd,this);return this},_disable:L.Editable.PathEditor.prototype.disable,_onFeatureDragStart:function(t){this.fireAndForward("editable:shape:dragstart",t);this.editLayer.clearLayers();this.commitDrawing()},_onFeatureDrag:function(t){this.fireAndForward("editable:shape:drag",t)},_onFeatureDragEnd:function(t){this.fireAndForward("editable:shape:dragend",t);this.initVertexMarkers();if(typeof this.updateResizeLatLng==="function"){this.updateResizeLatLng()}}});